<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>background • mapspam2globiom</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="background">
<meta property="og:description" content="mapspam2globiom">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapspam2globiom</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/background.html">Background</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Get started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/software.html">1. Software and hardware</a>
    </li>
    <li>
      <a href="../articles/template.html">2. Template</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Running SPAMc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/setup.html">1. Model setup</a>
    </li>
    <li>
      <a href="../articles/process_subnat_stat.html">2. Process subnational statistics</a>
    </li>
    <li>
      <a href="../articles/process_spatial_data.html">3. Process spatial data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iiasa/mapspam2globiom">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>background</h1>
            
      
      
      <div class="hidden name"><code>background.Rmd</code></div>

    </div>

    
    
<p>Comprehensive, detailed and spatially explicit information on the locations of crops is essential to inform agricultural and food policies. crop distribution maps are used to as crucial input for regional crop monitoring systems <span class="citation">(<span class="citeproc-not-found" data-reference-id="Fritz2019"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="Becker-Reshef2019"><strong>???</strong></span>)</span>, to analyse national irrigation potential <span class="citation">(You et al. 2014; <span class="citeproc-not-found" data-reference-id="Xie2017"><strong>???</strong></span>)</span> and to assess the impact of climate change and socioeconomic development on land use change and wider developmental trade-offs <span class="citation">(<span class="citeproc-not-found" data-reference-id="Ahmed2016"><strong>???</strong></span>)</span>.</p>
<p>Currently, the only source of information that provide spatial information on the location of crops are a number of global products <span class="citation">(<span class="citeproc-not-found" data-reference-id="Monfreda2008"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="Portmann2010"><strong>???</strong></span>; see <span class="citeproc-not-found" data-reference-id="Anderson2015"><strong>???</strong></span> for a comparison; You et al. 2014)</span>. These products use spatial information on land cover, suitability and irrigation to ‘grid’ (sub)national agricultural statistics at 5 arcmin (~10x10 kilometer at the equator) resolution. Apart from the Spatial Production Allocation Model, which latest version covers the year 2010 <span class="citation">(Yu et al. 2020)</span>, these datasets are rather outdated and cannot be used to track changes over time.</p>
<p>Global crop distribution maps are a useful starting point for national analysis but are of limited use when more detailed information is required. National decision makers often want to zoom in on subnational regions (e.g. bread basket areas) and investigate the shift in crops over time, which requires high(er) resolution maps. Also global products cannot easily be adapted when better information is available from local sources, such as national inventories of large-scale plantations, geo-coded data of irrigation schemes and national land cover maps.</p>
<p>An interesting alternative and new approach to create high resolution crop distribution maps are machine learning techniques, which can be used to identify the location of specific crops on satellite imagery. Although promising, these techniques are still under active development and the available studies predominantly target large-scale crops (e.g. soy bean and palm oil), which are easier to identify using machine learning classification approaches <span class="citation">(<span class="citeproc-not-found" data-reference-id="Zhong2016"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="Song2017"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="Danylo2020"><strong>???</strong></span>)</span>.</p>
<p>The Spatial Production Allocation Model (SPAMc) provides an approach to create plausible spatial estimates of physical and harvested crop area for Country level studies. The model builds on the global version of (SPAM) described in <span class="citation">You and Wood (2006)</span>, <span class="citation">You, Wood, and Wood-Sichra (2009)</span>, <span class="citation">You et al. (2014)</span> and <span class="citation">Yu et al. (2020)</span>, which uses a cross entropy framework to allocate subnational land use information on a 5 arcmin grid. We enhanced the model in several directions, including the possibility to increase the resolution of the maps to 30 arcsec (~1x1 kilometer at the equator).</p>
<div id="model-features" class="section level1">
<h1 class="hasAnchor">
<a href="#model-features" class="anchor"></a>Model features</h1>
<p><span class="citation">(<span class="citeproc-not-found" data-reference-id="VanDijk2020"><strong>???</strong></span>)</span> provides an in-depth discussion of SPAMc including an example for Southern Africa.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>The spatial allocation model outlined in this paper builds on SPAM, which technical details can be found in <span class="citation">Wood-Sichra, Joglekar, and You (2016)</span> (also see www.mapSPAM.org). SPAMc 42 crop and crop groups each split into four agricultural systems: subsistence, rainfed low-input, rainfed high-input and irrigated. Grid cell values are allocated subject to a set of constraints that capture information on the location of crops at the subnational level, cropland surface and irrigated area.</p>
<p>One major difference between both model versions is the use of an alternative objective function, which maximizes the total average ‘fitness’ score’ of the allocated crops (see below for a comparison of the two versions of the models) instead of using a cross-entropy framework. A key starting point for the cross-entropy framework is prior estimates of physical area for each crop-farming system combination at the grid cell level. The final solution of the model will be in the neighborhood of the priors but taking into account a number of constraints. Using this approach at the 30 arcsec resolution resulted in very fragmented allocation, in which the area of a large number of crop-farming system combinations will be allocated to single 30 arcsec grid cells. A more realistic distribution would result in clusters of 30 arcsec grid cells that are populated by a limited number of crop-farming system combinations and determined by biophysical and economic suitability. The objective function in SPAMc is better suited to simulate this process.</p>
<p>The first part of this section describes the model, starting with description the objective function, followed by the constraints. The second part outlines the approach we developed to backcast crop distribution maps for 2010 to the year 2000.</p>
<div id="objective-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#objective-functions" class="anchor"></a>Objective functions</h2>
<p>The actual location of crops will be determined by a combination of economic (e.g. market access and population density) and biophysical factors (e.g growing conditions determined by soil, temperature and precipitation). To simulate this process, we calculate a ‘fitness’ score between 0 and 100, which measures the economic and biophysical suitability at the grid cell level for each crop-farming system combination. The spatial allocation model is defined as a linear optimization problem in which the weighted score over all grid cells, crops and farming systems is maximized. This implies that on average all crops will be allocated to locations, which are considered as most appropriate from both an economic and biophysical viewpoint. The objective function is defined as follows:</p>
<p><span class="math display">\[\begin{equation}
\max\sum_{i} \sum_{j} \sum_{l}s_{ijl} \times score_{ijl}
(\#eq:obj)
\end{equation}\]</span></p>
<p>where, <span class="math inline">\(s_{ijl}\)</span> is the share of total physical area of crop <span class="math inline">\(j\)</span> and farming system <span class="math inline">\(l\)</span> allocated to grid cell <span class="math inline">\(i\)</span>, and <span class="math inline">\(score_{ijl}\)</span> is the fitness score for all <span class="math inline">\(j\)</span> and <span class="math inline">\(l\)</span> combinations.</p>
<p>The second channel is the use of priors. Instead of using the fitness score to allocate crop area, we use the cross-entropy (<span class="math inline">\(CE\)</span>) objective function used by SPAM, which minimizes the error between the prior information on physical area shares (<span class="math inline">\(\pi_{ijl}\)</span>) and the allocated shares of physical area (<span class="math inline">\(s_{ijl}\)</span>) for each grid cell <span class="math inline">\(i\)</span>, crop <span class="math inline">\(j\)</span> and farming system <span class="math inline">\(l\)</span>:</p>
<p><span class="math display">\[\begin{equation}
\min\ CE(s_{ijl}, \pi_{ijl})= \sum_{i} \sum_{j} \sum_{l}s_{ijl} \ lns_{ijl}- \sum_{i} \sum_{j} \sum_{l}s_{ijl} \ ln\pi_{ijl}
\end{equation}\]</span></p>
<div id="fitness-score-and-priors" class="section level3">
<h3 class="hasAnchor">
<a href="#fitness-score-and-priors" class="anchor"></a>Fitness score and priors</h3>
<p>Similar to SPAM, we assume that subsistence farmers mainly grow crops for their own consumption and therefore the rural population density is a reasonable proxy for the allocation of subsistence farming systems. As we are not using the crop-entropy approach, the allocation of subsistence farmers is modelled by means of a constraint (see next section). For the other three systems, the allocation is determined by maximizing the objective function. The fitness scores are very similar to the calculation of the priors that are used to inform the cross-entropy model in SPAM.</p>
<p>Low-input rainfed systems are characterized by smallholder farms that mostly sell their products on local markets. Farmers will specialize in growing crops for which environmental conditions are best, while market access plays a limited role. We therefore assume that the fitness core can be informed by an index of biophysical suitability:</p>
<p><span class="math display">\[\begin{equation}
score_{ijl} = suit\_index_{ijl} \quad l = low\ input \quad \forall i\ \forall j
\end{equation}\]</span></p>
<p>where <span class="math inline">\(score_{ijl}\)</span> and <span class="math inline">\(suit\_index_{ijl}\)</span> are the fitness score and the biophysical suitability score for grid cell <span class="math inline">\(i\)</span>, crop <span class="math inline">\(j\)</span> and farming system <span class="math inline">\(l\)</span>, respectively.</p>
<p>We assume that high-input rainfed and irrigated farming systems mostly consist of medium to large commercial farms, which location is largely determined by profit maximization. To simulate this, the fitness core is defined as the square root of potential revenue and market access:</p>
<p><span class="math display">\[\begin{equation}
score_{ijl} =  \sqrt{access_{i} \times rev_{ijl}} \quad l \in high\ input,\ irrigated \quad \forall i\ \forall j
\end{equation}\]</span></p>
<p>where <span class="math inline">\(access_{ijl}\)</span> is market access approximated by travel distance to large cities and <span class="math inline">\(rev_{ijl}\)</span> is potential revenue, calculated as the product of potential yield (<span class="math inline">\(yield_{ijl}\)</span>) for grid cell <span class="math inline">\(i\)</span>, crop <span class="math inline">\(j\)</span> and system <span class="math inline">\(l\)</span> and national level crop price (<span class="math inline">\(price_j\)</span>):</p>
<p><span class="math display">\[\begin{equation}
rev_{ijl} = pot\_yield_{ijl} \times price_{i}
\end{equation}\]</span></p>
</div>
<div id="constraints" class="section level3">
<h3 class="hasAnchor">
<a href="#constraints" class="anchor"></a>Constraints</h3>
<p>The allocation of crop area is determined by maximizing the objective function in equation @ref(eq:obj) subject to a set of constraints:</p>
<ol style="list-style-type: lower-roman">
<li>A constraint defining the range of permitted physical area shares:</li>
</ol>
<p><span class="math display">\[\begin{equation}
0 \leq s_{ijl} \leq 1
\end{equation}\]</span></p>
<ol start="2" style="list-style-type: lower-roman">
<li>A constraint, which forces that the sum of allocated physical area shares for each crop <span class="math inline">\(j\)</span> and farming system <span class="math inline">\(l\)</span> over all grid cells <span class="math inline">\(i\)</span> is equal to one. This ensures all physical crop area is allocated to grid cells.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\sum_{i}s_{ij}=1 \qquad \forall j\ \forall l
\end{equation}\]</span></p>
<ol start="3" style="list-style-type: lower-roman">
<li>A constraint, which specifies that the total physical area allocated to a grid cell <span class="math inline">\(i\)</span> is lower or equal than the available cropland (<span class="math inline">\(avail_{i}\)</span>) in grid cell <span class="math inline">\(i\)</span>.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\sum_{j} \sum_{l}crop\_area_{jl} \times s_{ijl} \leq avail_{i} \qquad \forall i
\end{equation}\]</span></p>
<p> where <span class="math inline">\(crop\_area_{jl}\)</span> is total national-level physical area for crop <span class="math inline">\(j\)</span> and farming system <span class="math inline">\(j\)</span>.</p>
<ol start="4" style="list-style-type: lower-roman">
<li>A constraint, which ensures that the allocated physical area is equal to the sub-national statistics (<span class="math inline">\(sub\_crop\_area_{jk}\)</span>) that are available for statistical reporting unit <span class="math inline">\(k\)</span> (i.e. a region or province) and crops <span class="math inline">\(J\)</span>. Crops for which only national level information is available are not affected by this constraint.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\sum_{i \in k} \sum_{l}crop\_area_{jl} \times s_{ijl} = sub\_crop\_area_{jk} \qquad \forall j \in J\
\forall k
\end{equation}\]</span></p>
<ol start="22" style="list-style-type: lower-alpha">
<li>A constraint, which specifies that the total allocated physical area for all irrigated crops <span class="math inline">\(L\)</span> in grid cell <span class="math inline">\(i\)</span> does not exceed the total available irrigated area (<span class="math inline">\(irr\_area_{i}\)</span>) in that grid cell.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\sum_{j \in L}crop\_area_{jl} \times s_{ijl} \leq irr\_area_{i} \qquad \forall i
\end{equation}\]</span></p>
<ol start="4" style="list-style-type: lower-roman">
<li>A constraint, that allocates the subsistence farming system crops proportional to rural population density. In cases, where the biophysical conditions are considered not suitable for a certain crop, we assume a zero allocation:</li>
</ol>
<p><span class="math display">\[\begin{equation}
\bar{s}_{ijl} = \frac{rur\_pop_i}{\sum_{i}{rur\_pop_i}} \quad l = subsistence \quad \forall i\ \forall j
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\bar{s}_{ijl}\)</span> is the share of physical area allocated to grid cell <span class="math inline">\(i\)</span> for crop <span class="math inline">\(j\)</span> and farming system <span class="math inline">\(l\)</span> and <span class="math inline">\(Pop_i\)</span> is the rural population density in grid cell <span class="math inline">\(i\)</span>.</p>
<p>(iiv) A constraint, which specifies the allocation of crops <span class="math inline">\(N\)</span> and farming systems <span class="math inline">\(O\)</span> for which detailed location information <span class="math inline">\(M\)</span> is available (<span class="math inline">\(det_{ijl}\)</span>), for example large commercial estates that produce sugarcane, tea or coffee. The constraint, ‘fixes’ the location of such estates on the map, while at the same time allowing the model to allocate the rest of the crop-farming systems ‘around’ them using the optimization routine. It extends the SPAM model, where this type of information was not used.</p>
<p><span class="math display">\[\begin{equation}
crop\_area_{jl} \times s_{ijl}= det_{ijl}  \qquad \forall i \in M\ \forall j \in N\ \forall l \in O
\end{equation}\]</span></p>
<p>We used R [@<span class="citation">(<span class="citeproc-not-found" data-reference-id="RCoreTeam2020"><strong>???</strong></span>)</span> to pre- and post-process all data and the General Algebraic Modeling System (GAMS) <span class="citation">(<span class="citeproc-not-found" data-reference-id="GAMSDevelopmentCorporation2019"><strong>???</strong></span>)</span> to solve the country specific models (See S2 and S4 for details). For Botswana constrained (iiv) was dropped as no detailed information on the spatial location of crops was available.</p>
<div id="refs" class="references">
<div id="ref-Wood-Sichra2016">
<p>Wood-Sichra, Ulrike, Alison B. Joglekar, and Liangzhi You. 2016. “Spatial Producion Allocation Model (SPAM) 2005: Technical Documentation.” Harvest Choice Working Paper. Washington, D.C.: International Food Policy Research (IFPRI).</p>
</div>
<div id="ref-You2006">
<p>You, Liangzhi, and Stanley Wood. 2006. “An entropy approach to spatial disaggregation of agricultural production.” <em>Agricultural Systems</em> 90 (1): 329–47. <a href="https://doi.org/10.1016/j.agsy.2006.01.008">https://doi.org/10.1016/j.agsy.2006.01.008</a>.</p>
</div>
<div id="ref-You2009">
<p>You, Liangzhi, Stanley Wood, and Ulrike Wood-Sichra. 2009. “Generating plausible crop distribution maps for Sub-Saharan Africa using a spatially disaggregated data fusion and optimization approach.” <em>Agricultural Systems</em> 99 (2): 126–40. <a href="https://doi.org/10.1016/j.agsy.2008.11.003">https://doi.org/10.1016/j.agsy.2008.11.003</a>.</p>
</div>
<div id="ref-You2014a">
<p>You, Liangzhi, Stanley Wood, Ulrike Wood-Sichra, and Wenbin Wu. 2014. “Generating global crop distribution maps: From census to grid.” <em>Agricultural Systems</em> 127: 53–60. <a href="https://doi.org/10.1016/j.agsy.2014.01.002">https://doi.org/10.1016/j.agsy.2014.01.002</a>.</p>
</div>
<div id="ref-Yu2020">
<p>Yu, Qiangyi, Liangzhi You, Ulrike Wood-Sichra, Yating Ru, Alison K. B. Joglekar, Steffen Fritz, Wei Xiong, Wenbin Wu, and Peng Yang. 2020. “A cultivated planet in 2010: 2. the global gridded agricultural production maps.” <em>Earth System Science Data</em>. <a href="https://doi.org/https://doi.org/10.5194/essd-2020-11">https://doi.org/https://doi.org/10.5194/essd-2020-11</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Note that the SPAMc version in mapspam2globiom is simpler version than the one described in <span class="citation">(<span class="citeproc-not-found" data-reference-id="VanDijk2020"><strong>???</strong></span>)</span> as it is not possible to blend in detailed information on the location of crops (e.g. OpenStreetMap information, large-farm surveys and machine learning products). It also does not include the approach to backcast crop distribution maps to earlier periods. These features might be added later.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michiel Van Dijk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
