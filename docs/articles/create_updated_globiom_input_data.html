<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create updated GLOBIOM land cover and crop distribution data â€¢ mapspam2globiom</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Create updated GLOBIOM land cover and crop distribution data">
<meta property="og:description" content="mapspam2globiom">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapspam2globiom</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/replace_globiom_land_cover_land_use.html">1. Replace land cover and land use information in GLOBIOM</a>
    </li>
    <li>
      <a href="../articles/create_updated_globiom_input_data.html">2. Create updated GLOBIOM land cover and crop distribution data</a>
    </li>
    <li>
      <a href="../articles/add_new_crop_to_globiom.html">3. Adding a new crop to GLOBIOM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iiasa/mapspam2globiom" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Create updated GLOBIOM land cover and crop
distribution data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iiasa/mapspam2globiom/blob/HEAD/vignettes/create_updated_globiom_input_data.Rmd" class="external-link"><code>vignettes/create_updated_globiom_input_data.Rmd</code></a></small>
      <div class="hidden name"><code>create_updated_globiom_input_data.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="create-updated-land-cover-and-crop-distribution-information">Create updated land cover and crop distribution information<a class="anchor" aria-label="anchor" href="#create-updated-land-cover-and-crop-distribution-information"></a>
</h2>
<p>With respect to the distribution of crops, GLOBIOM uses two related
data layers. A table with area information on the land cover per simu,
distinguishing seven major land use classes,some of which are split into
subclasses:</p>
<ul>
<li>Cropland (CrpLnd)</li>
<li>Other agricultural land (OthAgri)</li>
<li>Grassland (Grass)</li>
<li>Forest (Forest), separated into managed, unmanaged and rotation
forest</li>
<li>Wetlands (WetLnd)</li>
<li>Other natural vegetation (OthNatLnd)</li>
<li>Not relevant land cover (NotRel)</li>
</ul>
<p>The second table provides information on the location of the 18 crops
that are modeled by GLOBIOM, which together make up the Cropland class.
Other agricultural land shows the location of all the other crops. The
distribution of crops in the global version of the model is based on the
global Spatial Production Allocation Model (SPAM) for 2000.</p>
<p>The function <code><a href="../reference/create_globiom_input.html">create_globiom_input()</a></code> creates two gdx
files. One file updates the global land cover data in GLOBIOM for the
target country, while the other file replaces global land use data. Both
files will be saved in the <code>processed_data/results</code> folder.
Note that the area will be expressed in 1000 ha, which is common in
GLOBIOM. Before <code><a href="../reference/create_globiom_input.html">create_globiom_input()</a></code> can be run, you need
to prepare three input files. First, you need to collect a new country
level land cover map. Any product can be used as long as it contains
information on the six GLOBIOM land cover classes. The most obvious
choice would be to take a national land cover map for the year 2000 or
any other map that is close to the year for which the subnational
statistics are available. If such map is not available it is also
possible to use a global land cover product and use the country polygon
to mask the relevant area. An example mapping is included for the ESACCI
land cover files and can be opened by calling esacci2globiom. Finally, a
polygon file is needed with the location of the GLOBIOM simulation units
(simu), which can be clipped from the global GLOBIOM simu shapefile that
is stored in mapspamc_db (see <a href="https://michielvandijk.github.io/mapspamc/" class="external-link">mapspamc
package</a>).</p>
<p>In this example we will use the ESACCI land cover maps for which
historical information is available. Make sure to download the global
map first and follow all the steps to create crop distribution maps
using the <code>mapspamc</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># SOURCE PARAMETERS ----------------------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"01_model_setup/01_model_setup.r"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># LOAD DATA ------------------------------------------------------------------------------</span></span>
<span><span class="fu">load_data</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"adm_map"</span>, <span class="st">"grid"</span><span class="op">)</span>, <span class="va">param</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PROCESS --------------------------------------------------------------------------------</span></span>
<span><span class="va">temp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">model_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"processed_data/maps/land_cover"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">temp_path</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Warp and mask</span></span>
<span><span class="co"># If needed change the year of the land cover map</span></span>
<span><span class="co"># we use the ESACCI 2000 map here</span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">db_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"land_cover/ESACCI-LC-L4-LCCS-Map-300m-P1Y-2000-v2.0.7.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">align_raster</span><span class="op">(</span><span class="va">input</span>, <span class="va">grid</span>, <span class="va">adm_map</span><span class="op">$</span><span class="va">geometry</span>, method <span class="op">=</span> <span class="st">"near"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"land_cover"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="fu">writeRaster</span><span class="op">(</span><span class="va">output</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"land_ cover_{param$res}_{param$year}_{param$iso3c}.tif"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Next we will harmonize the crop distribution maps, generated with
<code>mapspamc</code> and the land cover map, and aggregate the land
cover classes and crop groups to the GLOBIOM aggregation. All of this is
done by the <code><a href="../reference/create_globiom_input.html">create_globiom_input()</a></code> function, which calls
several other functions under the hood.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the national land cover map, in this case ESACCI</span></span>
<span><span class="va">lc_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">spam_path</span>,</span>
<span>  <span class="fu">glue</span><span class="op">(</span><span class="st">"processed_data/maps/cropland/{param$res}/esa_raw_{param$year}_{param$iso3c}.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lc</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="va">lc_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read simu map from mapspamc_db</span></span>
<span><span class="va">simu</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">db_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"simu/simu.shp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read grid map created by mapspamc</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">model_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"processed_data/maps/grid/{param$res}/grid_{param$res}_{param$year}_{param$iso3c}.tif"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select country simu polygon</span></span>
<span><span class="va">simu</span> <span class="op">&lt;-</span> <span class="va">simu</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3c</span> <span class="op">==</span> <span class="va">param</span><span class="op">$</span><span class="va">iso3c</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simu</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create land cover mapping</span></span>
<span><span class="co"># We use the esacci2globion data.frame stored in the package.</span></span>
<span><span class="va">lc_map</span> <span class="op">&lt;-</span> <span class="va">esacci2globiom</span></span>
<span></span>
<span><span class="co"># Create crop mapping</span></span>
<span><span class="co"># We use the standard crop2globiom data.frame in the package.</span></span>
<span><span class="va">crop_map</span> <span class="op">&lt;-</span> <span class="va">crop2globiom</span></span>
<span></span>
<span><span class="co"># Create GLOBIOM input. Two files will be created.One with land cover information and one with crop distribution information. They will be saved in `\processed_data\results' folder of the `mapspamc` model folder. </span></span>
<span><span class="fu"><a href="../reference/create_globiom_input.html">create_globiom_input</a></span><span class="op">(</span><span class="va">lc_map</span>, <span class="va">crop_map</span>, <span class="va">lc</span>, <span class="va">simu</span>, <span class="va">grid</span>, <span class="va">param</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michiel Van Dijk.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
