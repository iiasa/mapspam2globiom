<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Post processing • mapspam2globiom</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Post processing">
<meta property="og:description" content="mapspam2globiom">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapspam2globiom</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Background</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/crop_distribution_maps.html">Crop distribution maps</a>
        </li>
        <li>
          <a href="../articles/model_description.html">Model description</a>
        </li>
        <li>
          <a href="../articles/data.html">Input data</a>
        </li>
        <li>
          <a href="../articles/appendix.html">Appendix</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Preparation</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/input_data_collection.html">Input data collection</a>
        </li>
        <li>
          <a href="../articles/template.html">Download template</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Run SPAMc</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/model_setup.html">1. Model setup</a>
        </li>
        <li>
          <a href="../articles/process_subnational_statistics.html">2. Process subnational statistics</a>
        </li>
        <li>
          <a href="../articles/process_spatial_data.html">3. Process spatial data</a>
        </li>
        <li>
          <a href="../articles/create_synergy_cropland.html">4. Create synergy cropland map</a>
        </li>
        <li>
          <a href="../articles/create_synergy_irrigated_area.html">5. Create synergy irrigated area map</a>
        </li>
        <li>
          <a href="../articles/combine_input_data.html">6. Combine input data</a>
        </li>
        <li>
          <a href="../articles/run_model.html">7. Run model</a>
        </li>
        <li>
          <a href="../articles/post_process.html">8. Post-processing</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iiasa/mapspam2globiom">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Post processing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iiasa/mapspam2globiom/blob/master/vignettes/post_process.Rmd"><code>vignettes/post_process.Rmd</code></a></small>
      <div class="hidden name"><code>post_process.Rmd</code></div>

    </div>

    
    
<div id="inspect-results-and-create-maps" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-results-and-create-maps" class="anchor"></a>Inspect results and create maps</h2>
<p>The package offers to functions to quickly inspect the results, after the model has been run. <code><a href="../reference/view_panel.html">view_panel()</a></code> shows crop distribution maps for a selected crop, using a different panel for each farming system. <code><a href="../reference/view_stack.html">view_stack()</a></code> shows the same information but stacking the various maps. Both functions plot the maps in the default browser overlaying the country polygon, unless specified otherwise. The visualization is done using <a href="https://leafletjs.com/">leafletjs</a>, which makes it possible to select different background tiles (e.g. OpenStreetMap) to put the data into perspective.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="../reference/view_panel.html">view_panel</a></span>(<span class="st">"rice"</span>, <span class="kw">var</span> <span class="kw">=</span> <span class="st">"ha"</span>, <span class="no">param</span>)
<span class="fu"><a href="../reference/view_stack.html">view_stack</a></span>(<span class="st">"rice"</span>, <span class="kw">var</span> <span class="kw">=</span> <span class="st">"ha"</span>, <span class="no">param</span>)</pre></body></html></div>
<p>As it is easier to process and visualize geo-spatial data when the data is saved in tif format, <code><a href="../reference/create_all_tif.html">create_all_tif()</a></code> produces a tif file for each crop - farming-system combination. The tif files are also needed as input to aggregate the data in a format that can be used by GLOBIOM, which is described next.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/create_all_tif.html">create_all_tif</a></span>(<span class="no">param</span>)</pre></body></html></div>
</div>
<div id="replacing-land-cover-and-land-use-information-in-globiom" class="section level2">
<h2 class="hasAnchor">
<a href="#replacing-land-cover-and-land-use-information-in-globiom" class="anchor"></a>Replacing land cover and land use information in GLOBIOM</h2>
<p>With respect to the distribution of crops, GLOBIOM uses two related data layers. A table with area information on the land cover per simu, distinguishing six different land use classes:</p>
<ul>
<li>Total agricultural land (CrpLnd, OthAgri)</li>
<li>Grassland (Grass)</li>
<li>Forest (Forest)</li>
<li>Wetlands (WetLnd)</li>
<li>Other natural vegetation (OthNatLnd)</li>
<li>Not relevant land cover (NotRel)</li>
</ul>
<p>And a corresponding table with more detailed information on the crop area per simu. The land cover class Total agricultural land is divided into two parts: (1) Cropland (CrpLnd), which presents the location of the 20 crops that are modelled by GLOBIOM and (2) Other agricultural land, which presents the location of all the other crops. More information on the construction of the land cover and land use layers can be found in <span class="citation">(<span class="citeproc-not-found" data-reference-id="Skalsky"><strong>???</strong></span>)</span></p>
<p>The function <code><a href="../reference/create_globiom_input.html">create_globiom_input()</a></code> creates two gdx files. One file updates the global land cover data in GLOBIOM for the target country, while the other file replaces global land use data. Both files will be saved in the <code>processed_data/results</code> folder. Before <code><a href="../reference/create_globiom_input.html">create_globiom_input()</a></code> can be run, you need to prepare three input files.</p>
<p>First, you need to collect a new country level land cover map. Any product can be used as long as it contains information on the six GLOBIOM land cover classes. The most obvious choice would be to take a national land cover map for the year 2000 or any other map that is close to the year for which the subnational statistics are available. If such map is not available it is also possible to use a global land cover product and use the country polygon to mask the relevant area. We illustrate this case for Malawi, where we used the <a href="https://www.esa-landcover-cci.org/2010">ESACCI</a> land cover map that was described in the section on <a href="input_data_collection.html">Input data collection</a>. We started by clipping the country area by running the script <code>03_spatial_data/select_esa.r</code> (see <a href="process_spatial_data.html">Process spatial data</a>).</p>
<p>Second, we prepared a table (<code>mappings/esacci2globiom.csv</code>) that maps the ESACCI land cover classes to the six GLOBIOM land cover classes. This table will be used to aggregate the land cover classes in the new map to the GLOBIOM land cover classes. You will have to prepare a similar table for your land cover map.</p>
<p>Finally, in case you want to add an additional crop, you have to update the table that maps the SPAMc crops to the 18 GLOBIOM crops (<code>mappings/crop2globiom.cvs</code>). In the example below, we will add coffee as a separate crop. The updated table will be loaded by <code><a href="../reference/create_globiom_input.html">create_globiom_input()</a></code> to aggregate the SPAMc crops to the GLOBIOM crop classification.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Select the new land cover map, in this case ESACCI</span>
<span class="no">lc_file</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">param</span>$<span class="no">spam_path</span>,
  <span class="fu">glue</span>(<span class="st">"processed_data/maps/cropland/{param$res}/esa_raw_{param$year}_{param$iso3c}.tif"</span>))
<span class="co"># Load the map</span>
<span class="no">lc_map</span> <span class="kw">&lt;-</span> <span class="fu">raster</span>(<span class="no">lc_file</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">lc_map</span>)

<span class="co"># Update crop2globiom.csv and map coff to coff (instead of the rest category) and overwrite</span>
<span class="fu"><a href="../reference/load_data.html">load_data</a></span>(<span class="st">"crop2globiom"</span>, <span class="no">param</span>)
<span class="no">crop2globiom</span> <span class="kw">&lt;-</span> <span class="no">crop2globiom</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">globiom_crop</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">crop</span> <span class="kw">==</span> <span class="st">"coff"</span>, <span class="st">"Coff"</span>, <span class="no">globiom_crop</span>))
<span class="fu">write_csv</span>(<span class="no">crop2globiom</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">param</span>$<span class="no">spam_path</span>, <span class="st">"mappings/crop2globiom.csv"</span>))

<span class="co"># Load mapping of lc classes to globiom lc classes</span>
<span class="no">lc_class2globiom</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">param</span>$<span class="no">spam_path</span>, <span class="st">"mappings/esacci2globiom.csv"</span>))

<span class="co"># Aggregate land cover map to GLOBIOM land cover classes at simu level</span>
<span class="co"># Not that the area will be expressed in 1000 ha, which is common in GLOBIOM!</span>
<span class="fu"><a href="../reference/create_globiom_input.html">create_globiom_input</a></span>(<span class="no">lc_class2globiom</span>, <span class="no">lc_map</span>, <span class="no">param</span>)</pre></body></html></div>
</div>
<div id="incorporate-new-data-into-globiom" class="section level2">
<h2 class="hasAnchor">
<a href="#incorporate-new-data-into-globiom" class="anchor"></a>Incorporate new data into GLOBIOM</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michiel Van Dijk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
