<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Appendix • mapspam2globiom</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Appendix">
<meta property="og:description" content="mapspam2globiom">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapspam2globiom</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Background</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/crop_distribution_maps.html">Crop distribution maps</a>
        </li>
        <li>
          <a href="../articles/model_description.html">Model description</a>
        </li>
        <li>
          <a href="../articles/data.html">Input data</a>
        </li>
        <li>
          <a href="../articles/appendix.html">Appendix</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Preparation</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/input_data_collection.html">Input data collection</a>
        </li>
        <li>
          <a href="../articles/template.html">Download template</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Run SPAMc</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/model_setup.html">1. Model setup</a>
        </li>
        <li>
          <a href="../articles/process_subnational_statistics.html">2. Process subnational statistics</a>
        </li>
        <li>
          <a href="../articles/process_spatial_data.html">3. Process spatial data</a>
        </li>
        <li>
          <a href="../articles/create_synergy_cropland.html">4. Create synergy cropland map</a>
        </li>
        <li>
          <a href="../articles/create_synergy_irrigated_area.html">5. Create synergy irrigated area map</a>
        </li>
        <li>
          <a href="../articles/combine_input_data.html">6. Combine input data</a>
        </li>
        <li>
          <a href="../articles/run_model.html">7. Run model</a>
        </li>
        <li>
          <a href="../articles/post_process.html">8. Post-processing</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iiasa/mapspam2globiom">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Appendix</h1>
            
      
      
      <div class="hidden name"><code>appendix.Rmd</code></div>

    </div>

    
    
<div id="solving-spamc" class="section level2">
<h2 class="hasAnchor">
<a href="#solving-spamc" class="anchor"></a>Solving SPAMc</h2>
<p>The General Algebraic Modeling System (GAMS) Release 25.0 <span class="citation">(GAMS Development Corporation 2019)</span> was used to solve SPAMc. The model was solved in two stages. In the first stage, we test if the model has a solution. As we combine information from many different sources, we often encounter inconsistencies, for example because the available cropland in a certain administrative area is lower than what is need to allocate according to the subnational statistics, resulting in an infeasible model. To investigate and reveal the inconsistencies we run the model using a set of slack variables on all constraints <span class="citation">(Boyd and Vandenberghe 2004)</span> and minimize the sum of slacks. If the model is solved with zero sum of slacks the data can be considered consistent and there is no need to make adjustments. In case slacks are larger than zero, they will show where and how the model is inconsistent and if, for example, there is not enough cropland or irrigated area.</p>
<p>To solve the inconsistencies, we start by inspecting the data for common errors (e.g. data entry errors in the subnational statistics) and, if needed, repair them. If there are still problems, we adjusted the data adopting a hierarchy of ‘credibility’ in the following decreasing order of importance:</p>
<ol style="list-style-type: decimal">
<li>Agricultural statistics</li>
<li>OpenStreetMap</li>
<li>Cropland</li>
<li>Irrigated area</li>
</ol>
<p>The agricultural statistics were not changed, except when the model proved to be infeasible and after all other modification options were exhausted. As discussed before OpenStreetMap (OSM) data was scaled to the year 2000 and 2010 using the cropland extent for these two periods. In case OSM data is larger than the statistics, we set decrease it accordingly. If there are inconsistencies with cropland and irrigated area, values are scaled up so that they match with the statistical totals reported for the smallest available administrative unit, while at the same time, checking that the corresponding totals at higher administrative units also continue to align <span class="citation">Wood-Sichra, Joglekar, and You (2016)</span> presents more details about the various procedures.</p>
<p>The first stage is also needed to distribute the crops that belong to the subsistence farming system. Equation 10 in the main text, fixes the allocation of these crops proportional to rural population density. However, this allocation will almost never be within the bounds of the model solution that are set by the other constraints. To ensure a feasible solution, a slack variable is essential.</p>
<p>In the second stage, the slack values determined in the first stage are ‘fixed’. This means that, for example, the cropland in an administrative area with problems has now been expanded to the original value plus the slack value. As the slack values account for all inconsistencies, the model can be solved.</p>
<p>The code to run the country models as well as the results are available from <span class="citation">(<span class="citeproc-not-found" data-reference-id="ADD"><strong>???</strong></span>)</span></p>
</div>
<div id="how-to-deal-with-slack" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-deal-with-slack" class="anchor"></a>How to deal with slack</h2>
</div>
<div id="storage-and-formats-of-model-input-and-output" class="section level2">
<h2 class="hasAnchor">
<a href="#storage-and-formats-of-model-input-and-output" class="anchor"></a>Storage and formats of model input and output</h2>
<p>Depending on the resolution of the model and the size of the country, the size of the input (raw and processed) and output files can become quite large. Hence it is important to ensure sufficient disk space to store the files. To give you an idea, all files related to the China example have a total size of <span class="citation">(<span class="citeproc-not-found" data-reference-id="ADD"><strong>???</strong></span>)</span>, while the total size for the Malawi example is <span class="citation">(<span class="citeproc-not-found" data-reference-id="ADD"><strong>???</strong></span>)</span>. We also encountered some problems when performing some of the GDAL operations using DropBox, probably related to the synchronization of files. If you encounter problems when saving to Dropbox, try saving to a folder that is not being synchronizated automatically.</p>
<p>In most cases we use the following file formats to store data: - Raster maps are stored using Geotiff (*.tif). - Shape files (i.e. vector/polygon data) are stored in the R .rds data format, which ensures the data structure is maintained and data can be quickly loaded into R. The shapefile with ADM information is also saved in .shp format as this is needed for GDAL. - Data files are stored in the R .rds data format. For files with lists of information (e.g. list of crops and ADMs in the country) we use .csv files for quick referencing (e.g. using Excel). - GAMS code is saved in .gms <span class="citation">(<span class="citeproc-not-found" data-reference-id="UPDATE"><strong>???</strong></span>)</span> - GAMS data files are stored in .gdx <span class="citation">(<span class="citeproc-not-found" data-reference-id="UPDATE"><strong>???</strong></span>)</span></p>
</div>
<div id="predefined-dimensions" class="section level2">
<h2 class="hasAnchor">
<a href="#predefined-dimensions" class="anchor"></a>Predefined dimensions</h2>
<div id="number-of-crops" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-crops" class="anchor"></a>Number of crops</h3>
<p>SPAMc models 40 different crop (and crop groups) that together cover the full agricultural sector and are each identified by a four letter code (Table 1).<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> The main reason for this classification is the limited availability of crop-specific biophysical suitability maps, which form a key element in the crop allocation process (see <a href="process_spatial_data.html">spatial data</a> for more information). It would be relatively easy to add new crops by splitting them off from broader crop groups (e.g. tropical and temperate fruits, and vegetables) if appropriate agricultural statistics and suitability maps would be available. We plan to add an example on how to do this in future updates. The actual number of crops in the model is determined by the number of crops that are actually grown in the target country and identified by the availability of national statistics.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"># Add 40 crop table</pre></body></html></div>
</div>
<div id="number-of-farming-systems" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-farming-systems" class="anchor"></a>Number of farming systems</h3>
<p>Also similar to global SPAM, SPAMc distinguises between four different farming systems:</p>
<ul>
<li>Rainfed subsistence</li>
<li>Rainfed low-input</li>
<li>Rainfed high-input</li>
<li>Irrigated</li>
</ul>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Boyd2004a">
<p>Boyd, Stephen, and Lieven Vandenberghe. 2004. <em>Convex Optimization</em>. Cambridge University Press. <a href="https://doi.org/10.1017/CBO9780511804441">https://doi.org/10.1017/CBO9780511804441</a>.</p>
</div>
<div id="ref-GAMSDevelopmentCorporation2019">
<p>GAMS Development Corporation. 2019. “General Algebraic Modeling System (GAMS).” Fairfax, VA. <a href="www.gams.com">www.gams.com</a>.</p>
</div>
<div id="ref-Wood-Sichra2016">
<p>Wood-Sichra, Ulrike, Alison B. Joglekar, and Liangzhi You. 2016. “Spatial Producion Allocation Model (SPAM) 2005: Technical Documentation.” Harvest Choice Working Paper. Washington, D.C.: International Food Policy Research (IFPRI).</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Global SPAM uses 42 different crops because it includes two types of millet and two types of coffee <span class="citation">(Wood-Sichra, Joglekar, and You 2016)</span>. As this level of detail is not supported by most national statistics and FAOSTAT, the have been merged into millet and coffee, respectively.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michiel Van Dijk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
