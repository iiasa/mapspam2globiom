---
title: "Input data collection"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(mapspam2globiom)
```

To create crop distribution maps with SPAMc, various [sources of data](data.html) are required, including national and subnational agricultural statistics, cropland exent, map of irrigated areas and spatially explicit information on economic and bio-physical suitability. This Section provides an overview of which data needs to be collected and where to store them so the can be used by SPAMc as input.


## Location of raw data

When the SPAMc is [setup](setup_model.html), you can set the location from where input data can be loaded. The default location is the `/raw_data` folder that is located within the SPAMc model folder. For practical reasons, we use separate subfolders for each data source (Table 1). In this way it is easy to keep the overview. 

If more detailed national information is available (e.g. national cropland map), they can simply be added by saving it in a new folder (e.g. national_cropland). The only exception are the location of subnational agricultural statistics, which are often taken from multiple sources and almost always require [manual intervention](process_subnat_stat.html) to prepare them for SPAMc. These are all stored in one folder `/raw_data/subnational_statistics.

As the model extracts data from a large number of global spatial datasets, which together can be very large (several Gigabytes!), it is possible to specify an alternative location for the raw data, such as a server or external drive. The parameter with the location of the raw data can be changed at any time so there is some flexibility to move the data around if needed. 

The names of the folders are fixed. Changing them would result in an error as SPAMc will not be able to find the relevant information.
As you probably have not gone through the setup part, you can either store all data in a temporary `/raw_data` folder or already create the SPAMc main folder and create the `raw_data` folder in there. 

@TODO Add folder structure for raw data.

```{r}
# TODO ADD raw_data structure.
```


## National agricultural statistics

National crop and price statistics are taken from [FAOSTAT](http://www.fao.org/faostat/en/#home) and [AQUASTAT](http://www.fao.org/aquastat/en/). 

### FAOSTAT crops database

Download the _All Data Normalized_ file (`Production_Crops_E_All_Data_(Normalized).zip`) from the FAOSTAT Crops statistics website [here](http://www.fao.org/faostat/en/#data/QC) and save it in the `data\raw\faostat` folder.

2. Unzip the file, which creates the file `Production_Crops_E_All_Data_(Normalized).csv`. Rename the file using the following format `YYYYMMDD_faostat_crops.csv` In this case we use: `20200303_faostat_crops.csv` 

3. Run the script `agricultural_statistics\1_process_faostat_crops.r` Before you run the script make sure to set the `faostat_version`, corresponding to the date the FAOSTAT files were downloaded, in this case `20200303`. The script will produce country specific files for harvested area statistics and saves them in the `data\processed\agricultural_statistics` folder, in our example: `faostat_crops_2020_CHN.rds`. 


### FAOSTAT Prices database

1. Download the _All Data Normalized_ file (`Prices_E_All_Data_(Normalized).zip`) from the FAOSTAT Producer Prices Anual statistics website [here](http://www.fao.org/faostat/en/#data/PP) and save it in the `data/raw/faostat` folder.

2. Unzip the file, which creates the file `Prices_E_All_Data_(Normalized).csv`. Rename the file using the following format `YYYYMMDD_faostat_prices.csv` In this case we use: `20200303_faostat_prices.csv`

3. Run the script [@UPDATE] `agricultural_statistics\1_process_faostat_prices.r` Before you run the script make sure to set the `faostat_version`, corresponding to the date the FAOSTAT files were downloaded, in this case `20200303`. The script will produce country specific files for price statistics and saves them in the `data\processed\agricultural_statistics` folder, in our example: `faostat_crop_prices_2010_CHN.rds`. 


### AQUASTAT irrigation statistics 

1. Download the irrigation data from AQUASTAT. As AQUASTAT does not offer a bulk download option, the the easiest way is to go the AQUASTAT database [here](http://www.fao.org/nr/water/aquastat/data/query/index.html?lang=en), tick the `irrigation and drainage development` box under variables and tick the target country. Click `submit` and then save the file by selecting `csv (flat)` on top of the page. Save this file in the `data/aquastat` folder. The name is not relevant so you can pick any name.

2. Unfortunately, the AQUASTAT csv file contains several empty lines and mixes up statistics and meta-data, which requires a bit of manual cleaning. Open the csv file in Excel and copy all contents to a new file, remove the empty lines in the beginning (the contents of cell A1 should now be `Area`) and remove the all rows starting with `metadata:` at the bottom of the file or (even better) copy the meta-data to a new worksheet called `metadata`. Rename the worksheet with the cleaned AQUASTAT data `data` and save it in using the following format, `YYYYMMDD_aquastat_irrigation.xlsx`, in this case `20200303_aquastat_irrigation.xlsx`

3. Run `process_aquastat.r`. Note that AQUATSTAT uses a a category 'Other fruits' to refer to irrigated fruits. This category, which is relatively rare, is mapped to the Tropical fruits (trof) class in SPAM. However, for some countries it might be more appropriate the map Other fruits to the Temperate fruits calls (temf). This can be done manually in the script. The code will display a message when the Other fruits category is present in the AQUASTAT data.   


## Subnational statistics 

*folder:* `02_agricultural_statistics`

SPAM needs three files with subnational crop statistics: (1) Information on harvested area at the most detaild ADM level, (2) Information on farming system shares per crop and (3) information on cropping intensity per crop. These files need to be prepared using a certain structure and format, which is described in detail in [@ADD annex]. Here we only present a brief summary on the steps to prepare the data for the model. For examples, have a look at the `subnational_harvested_area_2010_MWI.csv`, `farming_system_shares_2010_MWI.csv` and `cropping_intensity_2010_MWI.csv` in the `data/raw/subnational_statistics` folder.


### Harvested area

A .csv file with (raw) subnational statistics in the wide format. The file should contain harvested area for each ADM up to the most detailed ADM for which data is available. Hence, in case ADM2 level data is available, data should be supplied for ADM0, ADM1 and ADM2. In case ADM1 level data is available, data should be supplied for ADM0 and ADM1. In case no subnational data is available, there is no need to create this file as national data will be taken from FAOSTAT.

The first three columns of the file should present the adm names (`adm`), adm code (`adm_code`) and adm level (`adm_level`), which should match exactly with the adm names and adm codes used in the country shapefile. The next columns, one for each crop, present harvested area for crop and subnational unit using the name of the crop as header. Crop information should be aggregated to the 40 SPAM crop and crop groups. A one-to-one mapping table between the crop names in the raw statistics data file and the SPAM list must be stored in the `data/mappings/mappings_spam.xlsx` file in the `crop_orig2crop` worksheet. Note that the crop names are not allowed to contain any spaces but underscores ('_') are allowed.

The crops for which subnational data is available should be consistent and match with the list of crops for which FAOSTAT presents data. We use FAOSTAT as main source for the national statistics and all subnational information will be scaled to FAOSTAT.^[We might make this an option in updates of the package.]. See @ANNEX for more information on how to do this.  Empty cells or -999 can be used to indicate data is missing for certain crop and ADM combinations. In case a crop is not grown at all in the country (meaning FAOSTAT does not present data for it), values for all ADMs should be set to zero.  


### Farming system shares


### Cropping intensity


### Combine harvested area, farming system shares and cropping intensity






## Cropland extent

*folder*: `03_spatial_data`

As explained in Chapter \@ref(blocks), to demarcate the area where crops can be allocated a cropland extent is needed. To account for the uncertainty in the cropland extent, a synergy cropland map is constructed. There are two options to obtain this type of map. The first is to take an existing product that is available for 2010, which can be readily used as input. A second option is to construct a country specific synergy cropland extent. The latter might be preferred if high-quality country specific cropland maps are available. We explain both options below. 

### Global synergy cropland map for 2010

If SPAM is used to produce crop distribution maps for around 2010, it is possible to use a global synergy map produced by @Lu2020. This map was also used by for the global SPAM2010 [@@Yu2020]. The map, with a resolution of 500x500 meter, is constructed by means of the Self-adapting statistics allocation model (SASAM), which combines and ranks five different global cropland products: GlobeLand30, CCI-LC, GlobCover 2009, MODIS C5, and the Unified Cropland Layer, as well as several region cropland products, e.g. CORINE land cover for Europe for cropland maps for Australia and China. After harmonization of cropland classes, resolution and projection, cropland area statistics from FAOSTAT are used to rank the cropland maps and construct a scoring table that reflects the agreement among the datasets. In addition, maps are produced that contain the medium and maximum cropland area per grid cell.

1. Download the [@UPDATE] maps from the Harvard Dataverse that can be found [here](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/ZWSFAA). 

2. Run the `selec

For the China example 

### Creating a synergy cropland from scratch

- In annex?


Sources:
http://data.ess.tsinghua.edu.cn/ data at 250 m for 2001 and 2010!
Wang, J., C. Li., P. Gong. 2015. "Adaptively weighted decision fusion in 30 m land-cover mapping with Landsat and MODIS data." International Journal of Remote Sensing 36 (14): 3659-3674.

JRC dataset mentioned by ulrike and Yating



## Irrigated area

*folder*: `02_agricultural_statistics` and `03_spatial_data`

SPAM requires two pieces of data on irrigation. The first is information on the share of irrigated area per crop, which can be taken from the [AQUASTAT](http://www.fao.org/land-water/databases-and-software/aquastat/en/). The second is spatially-explicit information on the location of irrigated area or areas equipped for irrigation. We combine two sources of information: (1) the Global Map of Irrigated Areas (GMIA) version 5 [@ADD], which presents the location of the area equipped for irrigation at the 5 arcmin resolution and the Global Irrigation Areas map (GIA) [@ADD], which depicts irrigated area at a resolution of 30 arcsec. The second is


### Global map of irrigated areas (GMIA)

1. To download the GMIA Visit the GMIA website [here](http://www.fao.org/aquastat/en/geospatial-information/global-maps-irrigated-areas/latest-version/) and click the `Download the Global Map of Irrigation Areas - version 5.0 - area equipped for irrigation expressed in hectares per cell`.
Unzip and save the file in the `data/raw/gmia` folder.

2 Run `process_gmia.r to clip the country map and harmonize the resultion with the SPAM resolution set by the user. 


### Global irrigated area map (GIA)

1 To download the GIA, visit the gia data repository [here](https://doi.pangaea.de/10.1594/PANGAEA.884744) and download the zip file. Unzip the file and make sure that all files are in the `data/raw/gia` folder, not in a subfolder.

2. Run `process_gia.r` to clip the country map and harmonize the resultion with the SPAM resolution set by the user. 


### Biophysical suitability and potential yield

*folder*: `03_spatial_data`

Spatially explicit information on the biophysical suitability and related potential yield of crops is a key factor to inform the allocation of crops in SPAM. We use data the latest version of the global agro-ecological zones (GAEZ) data (version 3.0) as a source of information.^[It is expected that the results for GAEZv4 will be published soon. We will update this section when new data is available.] More information about the GAEZ can be found [here](http://www.fao.org/nr/gaez/en/). As downloading bulk information from this website is problematic, we stored the relevant GAEZ maps in a data repository.


1. Download the biophysical suitability and potential yield maps [here]@ADD and save the files in the `data/raw/gaez` folder.

2. Run `select_gaez.r` to clip the country maps. Note that this script needs some time to run as several hundreds of maps (crops x farming systems x variable) will have to be processed. 


## Accessibility

*folder*: `03_spatial_data`

We use global maps of travel time to major cities as a proxy for accesibility of cropland. To take into account changes in infrastructure over time, we use two products that each represent a different period. @Nelson2008 presents a global travel time map for 2000 and @Weiss2018 presents a comparable product for 2015. SPAM selects the older product if the model is run for using data before 2008, the midpoint between the two maps. So in case SPAM is run for 2008 or later, there is no need to download the map produced by @Nelson2008.

1. Download the Accessibility to cities 2015  map (raster format) from [here][https://malariaatlas.org/research-project/accessibility_to_cities/], unzip and save all files it in the `processed/data/travel_time_2015` folder (make sure to remove any subfolder). 
2 If relevant, download the Accessibility to cities 2000  map from [here][https://forobs.jrc.ec.europa.eu/products/gam/], unzip and all files in in the `processed/data/travel_time_2000` folder (make sure to remove any subfolder).
3. Run `select_travel_time_2000_2015.r`


## Rural population

*folder*: `03_spatial_data`

We use to two sources of information to create a map of a country's rural population.  The first is [WorldPop](https://www.worldpop.org/), which presents time series for gridded population. WorldPop maps were generated by applying a machine learning approach to downscale subnational population information. The second source is the [Global Rural-Urban Mapping Project (GRUMPv1)](https://sedac.ciesin.columbia.edu/data/collection/grump-v1), which present polygon information on urban areas that are identified by the extent of the nighttime lights and approximated urban extents (circles) based on buffered settlement points.^[GRUMP is a somewhat outdated product as it presents data for the year 1995. We aim to replace it by a more recent source @ADD.] SPAM combines the Worldpop and GRUMP datasets to create a map of rural population.


### Gridded population
1. Download the WorldPop Global mosaics 2000-2020 dataset, which can be downloaded [here](https://www.worldpop.org/project/categories?id=3). The global map present the number of people per pixel a resolution of 1kmx1km. ^[WordPop also offers the possibility to download individual country maps at a resolution of 100mx100m. These files are relatively much larger, in particular for large countries like China and are not required as we will aggregate the population maps to 30 arcsec - the current highest SPAM resolution.] Save the file in the `processed/data/worldpop` folder.

2. Run `select_worldpop.r`


### Urban extent

1. Download GRUMPS [here](https://sedac.ciesin.columbia.edu/data/set/grump-v1-urban-ext-polygons-rev01/data-download). Note than one needs to register before file can be downloaded. Save the file in the `processed/data/grump` folder. 

2. Run 'select_grump.r`.



