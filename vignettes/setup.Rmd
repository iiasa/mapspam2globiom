---
title: "Model setup"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{setup}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
resource_files:
  bib/mapspam.bib
bibliography: bib/mapspam.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

To setup SPAMc two steps need to be taken (the order is important!). It is assumed that all required software is already installed and working (see [software and hardware](software.html)). As [mentioned](template.html), it is by far the easiest to install the template in an RStudio project first and then start to work on your own country SPAMc version as all the steps discussed from now on are already pre-coded in the template.

## Create SPAMc folder structure

mapspam2globiom includes a function to create all necessary folders `create_spam_folders()`. The only input it requires is a path on your harddisk. We do not recommend using a server to store the model as the potential increase in file access time might seriously affect the time it takes to process some of the spatial datasets which can be very large. Note that it is perfectly fine to store large *raw data* files on a server (see below). 

```{r eval=FALSE}
# Load mapspam2globiom
library("mapspam2globiom")

# Set the folder where the model will be stored
# Note that R uses forward slashes even in Windows!!
spamc_path <- "C:/Users/dijk158/Dropbox/mapspam2globiom_mwi"

# Create SPAMc folder structure in the spamc_path
create_spam_folders(spamc_path)
```


## Set model parameters and location of files

Nearly all functions in mapspam2globiom need input on (1) key parameters that determine the design of the model and how will be solved and (2) the location of raw and intermediate data, which will be processed. Both pieces of information are bundled and stored by the function `set_spam_par()`.


`set` script needs to be prepared before SPAM can be set up. It has the following parameters.

### Set country

SPAM uses ISO 3166-1 alpha-3 codes (hereafter iso3c) to determine the country and extract relevant data from global databases.  ISO 3166-1 alpha-3 codes are three-letter country codes defined in ISO 3166-1, part of the ISO 3166 standard published by the International Organization for Standardization (ISO). A full list of iso3c codes can be found on Wikipedia [here](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3). For China the iso3c code is `CHN`. Not all data sources use iso3c codes so we added a script to determine a number of other country identifiers, including the standard full country name, the iso3 numerical code and the country identifier used by FAOSTAT. We also add the continent information, which is sometimes needed to select a continent-level spatial map.

```{r eval=FALSE}
iso3c_sel <- "CHN"
country_sel <- countrycode(iso3c_sel, "iso3c", "country.name")
iso3n_sel <- countrycode(iso3c_sel, "iso3c", "iso3n")
fao_sel <- countrycode(iso3c_sel, "iso3c", "fao")
continent_sel <- countrycode(iso3c_sel, "iso3c", "continent")
```

### Set year

```{r}
year_sel <- 2010
```

### Set resolution

Two options `30sec` or `5min`

```{r}
grid_sel <- "5min"
```

### Set administrative zone level



```{r}
adm_sel <- 2
```


### Set solve level

Solve at country level (solve_sel = 0) or at adminstrative level (solve_sel = 1)

```{r}
solve_sel <- 1
```


### Set file location

```{r, eval=F}
### SET DATAPATH
# Michiel IIASA
if(Sys.info()["user"] == "vandijkm") {
  glob_path <- "P:/globiom/crop_map/data/Global"
  crop_map_path <- "E:/Dropbox/crop_map_CHN"
  mappings_path <- file.path(crop_map_path, paste0("data/mappings"))
  iso3c_path <- file.path(crop_map_path, paste0("data/", year_sel, "/", iso3c_sel))
  raw_path <- file.path(iso3c_path, "raw")
  proc_path <- paste0(iso3c_path, "/processed")
  spam_path <- file.path(crop_map_path, paste0("SPAM_2.0/", year_sel, "/", iso3c_sel))
  gams_path <- "C:/GAMS/win64/25.0"
}

```


## Create data folder structure

Reads folder location from `set_parameters.r`

```{r}

```


This creates the folder structure as depicted below in the R project.

```{r f_structure, echo=FALSE, message=FALSE, warning=FALSE, comment=NA}
#source("R/depict_folder_structure.R")
#print(f_structure)
```

Now the model is set up, it is time to collect input data and put them in the right location, which is described in Chapter \@(data)
